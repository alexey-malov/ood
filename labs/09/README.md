# Лабораторная работа №9. Паттерн проектирования "Заместитель"

- [Лабораторная работа №9. Паттерн проектирования "Заместитель"](#лабораторная-работа-9-паттерн-проектирования-заместитель)
  - [Критерии оценивания лабораторной работы](#критерии-оценивания-лабораторной-работы)
  - [Обязательные задания](#обязательные-задания)
    - [Задание 1 – Применить оптимизацию Copy-on-write для хранения изображения в виде тайлов  – 100 баллов](#задание-1--применить-оптимизацию-copy-on-write-для-хранения-изображения-в-виде-тайлов---100-баллов)
      - [Бонус в 30 баллов за покрытие классов Image и Tile тестами](#бонус-в-30-баллов-за-покрытие-классов-image-и-tile-тестами)
      - [Бонус в 50 баллов за реализацию функции рисования окружности](#бонус-в-50-баллов-за-реализацию-функции-рисования-окружности)
      - [Бонус в 50 баллов за реализацию функции рисования круга](#бонус-в-50-баллов-за-реализацию-функции-рисования-круга)
      - [Бонус в 50 баллов за поддержку цветных изображений](#бонус-в-50-баллов-за-поддержку-цветных-изображений)


## Критерии оценивания лабораторной работы

При сдаче лабораторной работы студент должен уметь ответить на вопросы преподавателя насчёт используемых паттернов проектирования, уметь изобразить схему паттерна на диаграмме классов, а также продемонстрировать диаграмму классов своего приложения.

- На оценку «удовлетворительно» необходимо набрать 80 баллов.
- На оценку «хорошо» необходимо набрать 150 баллов.
- На оценку «отлично» необходимо набрать 250 баллов.

## Обязательные задания

### Задание 1 – Применить оптимизацию Copy-on-write для хранения изображения в виде тайлов  – 100 баллов

Реализуйте хранение растровых изображений, использующий оптимизацию Copy on write.

Чтобы хранить и манипулировать изображениями, разработайте класс `Image`, который хранит пиксели изображения и предоставляет методы для управления изображением:

- `GetPixel`. Возвращает цвет пикселя в заданных координатах. Если координаты выходят за пределы изображения, должен возвращаться пробел.
- `SetPixel`. Изменяет цвет пикселя с заданными координатами. Если координаты выходят за пределы изображения, метод ничего не делает.
- `GetSize`. Возвращает размер изображения в пикселях.

Изображение должно храниться в виде набора Copy-on-write тайлов, как описано в лекции. Сразу после своего создания изображение должно быть заполнено одним цветом и использовать один тайл.

![Изображение в виде тайлов](images/tiled-image-example.png)

Тайл изображения фиксированного размера представлен в виде класса `Tile`. В качестве цвета пикселя используется тип `char`. В классе реализуйте методы:

- `SetPixel`. Изменяет цвет пикселя в пределах тайла. Если координаты выходят за пределы тайла, метод не делает ничего.
- `GetPixel`. Возвращает цвет пикселя тайла с указанными координатами. Если координаты выходят за пределы тайла, возвращается пробел.
- `GetInstanceCount`. Статический метод, возвращающий количество тайлов в программе. Этот метод нужен, чтобы тесты могли проверить правильность работы программы.

В заготовке кода даны:

- Структура `Point`. Хранит координаты точки.
- Структура `Size`. Хранит размеры (ширину и высоту) графических объектов: тайлов и изображений.
- Шаблонный класс `CoW`. Реализует оптимизацию Copy on write, как описано в лекции.
- Класс `Image`. Изображение с поддержкой Copy on write на уровне тайлов. Его методы вам нужно реализовать.
- Класс `Tile`. Тайл изображения фиксированного размера. Его методы вам нужно реализовать. Размеры тайла не меняйте.
- Функция `DrawLine`. Рисует по точкам отрезок прямой линии, используя [алгоритм Брезенхэма](https://ru.wikipedia.org/wiki/Алгоритм_Брезенхэма).
- Функция `LoadImage`. Загружает изображение из строки символов, в которой линии изображения разделяются символом перевода строки.
- Функция `Print`. Выводит изображение в поток вывода.

На основе разработанных классов, функций и структур создайте программа должна нарисовать в изображении некоторое осмысленное изображение (домик, робота, что-то ещё) и вывести его на экран.

#### Бонус в 30 баллов за покрытие классов Image и Tile тестами

Напишите юнит-тексты для классов `Image` и `Tile`. Для проверки количества тайлов используйте метод `Tile::GetInstanceCount`.

#### Бонус в 50 баллов за реализацию функции рисования окружности

Напишите функцию `void DrawCircle(Image& image, Point center, int radius, char color)`,
рисующую на изображении окружность заданного радиуса и цвета.
Для рисования используйте алгоритм Брезенхэма для рисования окружности.
Внимание, не все реализации алгоритма Брезенхема из Интернета работают корректно.
Это можно увидеть на оуружности радиуса 4.

Правильная окружность рисуется так:

```txt
   ###
  #   #
 #     #
#       #
#       #
#       #
 #     #
  #   #
   ###
```

Неправильная — так:

```txt
   ###
 ##   ##
 #     #
#       #
#       #
#       #
 #     #
 ##   ##
   ###
```

Выводимый программой рисунок должен содержать как минимум одну окружность.

#### Бонус в 50 баллов за реализацию функции рисования круга

Напишите функцию `void FillCircle(Image& image, Point center, int radius, char color)`, рисующую на изображении круг заданного радиуса и цвета. Для закрашивания внутренней области используйте горизонтальные или вертикальные отрезки линий, а границы круга вычисляйте с помощью алгоритма Брезенхэма.

Выводимый программой рисунок должен содержать как минимум один закрашенный круг.

#### Бонус в 50 баллов за поддержку цветных изображений

Вместо типа char используйте тип `uint32_t`, хранящий интенсивности красной, синей, зелёной составляющей цвета, упакованных в 32-битной число в формате RGB или BGR. По окончании рисования программа должна сохранить изображение, например, в [формате .ppm](https://ru.wikipedia.org/wiki/Portable_anymap).

